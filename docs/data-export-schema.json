{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "UserDataExport",
  "description": "Schema describing the structure of a full user data export generated by the User Management module.",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Information about this export generation.",
      "properties": {
        "exportId": {
          "type": "string",
          "description": "Unique identifier for this export operation"
        },
        "generatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "ISO timestamp when the export was generated"
        },
        "format": {
          "type": "string",
          "enum": ["json", "csv"],
          "description": "Export file format"
        },
        "categories": {
          "type": "array",
          "description": "Data categories included in this export",
          "items": { "$ref": "#/$defs/exportCategory" }
        }
      },
      "required": ["generatedAt", "format"]
    },
    "user": {
      "type": "object",
      "description": "Basic account information",
      "properties": {
        "id": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "username": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "updatedAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "email"]
    },
    "profile": { "$ref": "#/$defs/profile" },
    "preferences": { "$ref": "#/$defs/preferences" },
    "authenticationHistory": {
      "type": "array",
      "items": { "$ref": "#/$defs/authLog" },
      "description": "Chronological authentication events"
    },
    "sessions": {
      "type": "array",
      "items": { "$ref": "#/$defs/session" },
      "description": "Active or historical sessions"
    },
    "consents": {
      "type": "array",
      "items": { "$ref": "#/$defs/consent" },
      "description": "Consent records associated with the user"
    },
    "memberships": {
      "type": "array",
      "items": { "$ref": "#/$defs/membership" },
      "description": "Team or organization memberships"
    },
    "roles": {
      "type": "array",
      "items": { "$ref": "#/$defs/roleAssignment" },
      "description": "Role assignments for this user"
    },
    "permissions": {
      "type": "array",
      "items": { "$ref": "#/$defs/permissionAssignment" },
      "description": "Permission assignments for this user"
    }
  },
  "$defs": {
    "exportCategory": {
      "type": "string",
      "enum": [
        "profile",
        "preferences",
        "authenticationHistory",
        "sessions",
        "consents",
        "memberships",
        "roles",
        "permissions"
      ]
    },
    "profile": {
      "type": "object",
      "properties": {
        "first_name": { "type": ["string", "null"] },
        "last_name": { "type": ["string", "null"] },
        "avatar_url": { "type": ["string", "null"], "format": "uri" },
        "bio": { "type": ["string", "null"] },
        "date_of_birth": { "type": ["string", "null"], "format": "date" },
        "gender": { "type": ["string", "null"] },
        "address": { "type": ["string", "null"] },
        "city": { "type": ["string", "null"] },
        "state": { "type": ["string", "null"] },
        "country": { "type": ["string", "null"] },
        "postal_code": { "type": ["string", "null"] },
        "phone_number": { "type": ["string", "null"] },
        "website": { "type": ["string", "null"], "format": "uri" },
        "created_at": { "type": ["string", "null"], "format": "date-time" },
        "updated_at": { "type": ["string", "null"], "format": "date-time" }
      }
    },
    "preferences": {
      "type": "object",
      "properties": {
        "language": { "type": ["string", "null"] },
        "theme": { "type": ["string", "null"], "enum": ["light", "dark", "system"] },
        "notifications": {
          "type": "object",
          "properties": {
            "email": { "type": "boolean" },
            "push": { "type": "boolean" },
            "marketing": { "type": "boolean" }
          },
          "additionalProperties": true
        },
        "itemsPerPage": { "type": ["integer", "null"] },
        "timezone": { "type": ["string", "null"] },
        "dateFormat": { "type": ["string", "null"] }
      }
    },
    "authLog": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "action": { "type": "string" },
        "ipAddress": { "type": ["string", "null"], "format": "ipv4" },
        "userAgent": { "type": ["string", "null"] },
        "created_at": { "type": "string", "format": "date-time" }
      }
    },
    "session": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "created_at": { "type": "string", "format": "date-time" },
        "last_active_at": { "type": ["string", "null"], "format": "date-time" },
        "ip_address": { "type": ["string", "null"], "format": "ipv4" },
        "user_agent": { "type": ["string", "null"] },
        "is_current": { "type": ["boolean", "null"] }
      }
    },
    "consent": {
      "type": "object",
      "properties": {
        "marketing": { "type": "boolean" },
        "updatedAt": { "type": "string", "format": "date-time" }
      }
    },
    "membership": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "organizationId": { "type": "string" },
        "organizationName": { "type": ["string", "null"] },
        "role": { "type": "string" },
        "status": { "type": "string" },
        "joinedAt": { "type": ["string", "null"], "format": "date-time" },
        "leftAt": { "type": ["string", "null"], "format": "date-time" }
      }
    },
    "roleAssignment": {
      "type": "object",
      "properties": {
        "roleId": { "type": "string" },
        "roleName": { "type": "string" },
        "assignedAt": { "type": "string", "format": "date-time" }
      }
    },
    "permissionAssignment": {
      "type": "object",
      "properties": {
        "permissionId": { "type": "string" },
        "permissionName": { "type": "string" },
        "grantedByRoleId": { "type": ["string", "null"] }
      }
    }
  }
}
